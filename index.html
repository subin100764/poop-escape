<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë˜¥ì˜ í•˜ìˆ˜ë„ íƒˆì¶œ</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Courier New', sans-serif; background-color: #5d4037; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; max-width: 600px; margin: 0 auto; background: #808080; }
        canvas { display: block; background: #444; width: 100%; height: 100%; }
        
        /* í™ˆ í™”ë©´ - ê°€ì¥ ìœ„ì— ë³´ì´ë„ë¡ ì„¤ì • */
        #home-screen { position: absolute; inset: 0; background: #5d4037; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; color: white; text-align: center; }
        .pixel-poop { font-size: 80px; margin-bottom: 10px; }
        .btn { padding: 15px 40px; font-size: 24px; cursor: pointer; background: #8d6e63; border: 4px solid #3e2723; color: white; margin: 10px; border-radius: 10px; z-index: 1000; }
        
        /* UI */
        #ui { position: absolute; top: 10px; left: 10px; color: white; font-weight: bold; pointer-events: none; z-index: 100; font-size: 18px; text-shadow: 2px 2px black; }
        #game-over { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 500; color: white; }
        #flush-anim { position: absolute; inset: 0; background: #2196f3; display: none; z-index: 800; flex-direction: column; align-items: center; justify-content: center; font-size: 30px; color: white; }
        .swirl { font-size: 80px; animation: rotate 1s infinite linear; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">ì‹œê°„: <span id="timer">30</span> | ë³„: <span id="star-count">0</span></div>
    
    <div id="home-screen">
        <div class="pixel-poop">ğŸ’©</div>
        <h1>í•˜ìˆ˜ë„ íƒˆì¶œ ì‘ì „</h1>
        <p>ëˆ„ì  ë³„: <span id="total-stars">0</span></p>
        <button class="btn" onclick="startGame()" ontouchstart="startGame()">íƒˆì¶œ ì‹œì‘!</button>
    </div>

    <div id="game-over">
        <h2>í•˜ìˆ˜ë„ íƒˆì¶œ ì‹¤íŒ¨...</h2>
        <button class="btn" onclick="continueGame()" ontouchstart="continueGame()">ê³„ì† (ë³„ 5ê°œ)</button>
        <button class="btn" onclick="location.reload()">í™ˆìœ¼ë¡œ</button>
    </div>

    <div id="flush-anim">
        <div class="swirl">ğŸ’©</div>
        <p><b>ë°”ë‹¤ë¡œ íƒˆì¶œ ì„±ê³µ!</b></p>
    </div>

    <canvas id="gameCanvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let player = { x: 0, y: 100, size: 40 };
    let obstacles = [];
    let stars = [];
    let gameActive = false;
    let score = 0;
    let totalStars = parseInt(localStorage.getItem('poop_stars')) || 0;
    let timeLeft = 30;
    let gameInterval, timerInterval;

    function init() {
        canvas.width = document.getElementById('game-container').clientWidth;
        canvas.height = document.getElementById('game-container').clientHeight;
        player.x = canvas.width / 2 - 20;
        document.getElementById('total-stars').innerText = totalStars;
    }
    window.onload = init;

    let keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // ì‹œì‘ í•¨ìˆ˜
    function startGame() {
        // í™”ë©´ ì „í™˜
        document.getElementById('home-screen').style.setProperty('display', 'none', 'important');
        document.getElementById('game-over').style.display = 'none';
        
        // ì´ˆê¸°í™”
        obstacles = [];
        stars = [];
        score = 0;
        timeLeft = 30;
        player.x = canvas.width / 2 - 20;
        gameActive = true;
        
        document.getElementById('star-count').innerText = score;
        document.getElementById('timer').innerText = timeLeft;

        if(gameInterval) clearInterval(gameInterval);
        if(timerInterval) clearInterval(timerInterval);

        gameInterval = setInterval(update, 1000/60);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if(timeLeft <= 0) winGame();
        }, 1000);
    }

    function update() {
        if(!gameActive) return;

        if(keys['ArrowLeft'] && player.x > 0) player.x -= 7;
        if(keys['ArrowRight'] && player.x < canvas.width - player.size) player.x += 7;

        if(Math.random() < 0.04) obstacles.push({ x: Math.random()*(canvas.width-30), y: canvas.height, size: 30 });
        if(Math.random() < 0.015) stars.push({ x: Math.random()*(canvas.width-30), y: canvas.height, size: 25 });

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ë°°ê²½(í•˜ìˆ˜ë„ ë¼ì¸)
        ctx.strokeStyle = "#555";
        ctx.beginPath();
        ctx.moveTo(canvas.width/3, 0); ctx.lineTo(canvas.width/3, canvas.height);
        ctx.moveTo(canvas.width*2/3, 0); ctx.lineTo(canvas.width*2/3, canvas.height);
        ctx.stroke();

        // ì£¼ì¸ê³µ
        ctx.font = "40px Arial";
        ctx.fillText("ğŸ’©", player.x, player.y + 35);

        // ì¥ì• ë¬¼
        obstacles.forEach((ob, i) => {
            ob.y -= 5;
            ctx.fillStyle = "red";
            ctx.beginPath();
            ctx.moveTo(ob.x, ob.y + ob.size);
            ctx.lineTo(ob.x + ob.size/2, ob.y);
            ctx.lineTo(ob.x + ob.size, ob.y + ob.size);
            ctx.fill();
            if(player.x < ob.x + 25 && player.x + 35 > ob.x && player.y < ob.y + 25 && player.y + 35 > ob.y) gameOver();
            if(ob.y < -50) obstacles.splice(i, 1);
        });

        // ë³„
        stars.forEach((s, i) => {
            s.y -= 5;
            ctx.font = "25px Arial";
            ctx.fillText("â­", s.x, s.y + 25);
            if(player.x < s.x + 25 && player.x + 35 > s.x && player.y < s.y + 25 && player.y + 35 > s.y) {
                score++;
                totalStars++;
                document.getElementById('star-count').innerText = score;
                localStorage.setItem('poop_stars', totalStars);
                stars.splice(i, 1);
            }
            if(s.y < -50) stars.splice(i, 1);
        });
    }

    function gameOver() {
        gameActive = false;
        clearInterval(gameInterval);
        clearInterval(timerInterval);
        document.getElementById('game-over').style.display = 'flex';
    }

    function continueGame() {
        if(totalStars >= 5) {
            totalStars -= 5;
            localStorage.setItem('poop_stars', totalStars);
            document.getElementById('total-stars').innerText = totalStars;
            document.getElementById('game-over').style.display = 'none';
            gameActive = true;
            gameInterval = setInterval(update, 1000/60